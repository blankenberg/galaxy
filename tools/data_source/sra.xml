<?xml version="1.0"?>
<tool name="SRA" id="sra_source" tool_type="data_source" version="1.0.0">
    <description>server</description>
    <requirements>
        <requirement type="package" version="8.25">coreutils</requirement>
        <requirement type="package" version="2.10.1">sra-tools</requirement>
    </requirements>
    <command><![CDATA[
        python  '${__tool_directory__}/data_source.py' '${output}' '${__app__.config.output_size_limit}'
        &&
        mkdir 'output_sra';
        for i in `tail -n +2 '${output}' | cut -d ',' -f 1` ; do
            prefetch \$i --output-file output_sra/\$i.sra; ##TODO: allow creating an on-demand sra object in Galaxy
        done
    ]]></command>
    <inputs action="https://www.ncbi.nlm.nih.gov/Traces/study2" check_values="false" method="get">
        <display>go to SRA server $GALAXY_URL</display>
        <param name="GALAXY_URL" type="baseurl" value="/tool_runner?tool_id=sra_source" />
    </inputs>
    <outputs>
        <data name="output" format="csv" label="SRA manifest"/>
        <collection name="sra_output" type="list" label="SRA accession archives (SRA files)">
            <discover_datasets pattern="(?P&lt;identifier_0&gt;.+)\.sra" ext="sra" directory="output_sra" visible="false" />
        </collection>
    </outputs>
    <options sanitize="False" refresh="True"/>
    <citations>
        <citation type="doi">10.1093/database/bar011</citation>
        <citation type="doi">10.1093/nar/gkq1019</citation>
    </citations>
</tool>

